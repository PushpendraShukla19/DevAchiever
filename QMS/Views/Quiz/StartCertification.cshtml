@model QMS.Models.CertificationQuestion
@{
    ViewData["Title"] = "Question Page";
}

<section id="service-details" class="service-details section">
    <div class="container">
        <div class="row gy-4">

            <!-- Left Sidebar - Certification List -->
            <div class="col-lg-4" data-aos="fade-up" data-aos-delay="100">
                <div class="services-list">
                    <a href="#" class="active">@Model.CertificationName</a>
                </div>
                <h4>Certification Quiz</h4>
                <p>Answer the following questions to test your knowledge and earn certification credit. Each question has one correct answer.</p>
                <a href="~/Quiz" class="btn-getstarted"> <i class="bi bi-arrow-left"></i> Back</a>
            </div>

            <!-- Right Content - Questions and Options -->
            <div class="col-lg-8" data-aos="fade-up" data-aos-delay="200">
                <h3>@Model.CertificationName - Knowledge Assessment</h3>
                <p>
                    Please select the best answer for each question below. Your progress will be tracked and evaluated upon submission.
                </p>

                <form id="quizForm">
                    @{
                        int index = 1;
                    }
                    @foreach (var q in Model.Questions)
                    {
                        <div class="quiz-question mb-4">
                            <h5>@index. @q.QuestionText</h5>
                            <ul class="list-unstyled">
                                @foreach (var opt in q.Options)
                                {
                                    <li>
                                        <label class="d-block show-mouse">
                                            <input type="radio"
                                                   name="question_@q.QuestionId"
                                                   value="@opt.OptionId"
                                                   class="me-2 show-mouse" />
                                            @opt.OptionText
                                        </label>
                                    </li>
                                }
                            </ul>
                            <hr />
                        </div>
                        index++;
                    }

                    <button type="button" class="btn btn-primary mt-3" onclick="submitQuiz()">Submit Answers</button>
                </form>

                <div id="result" class="mt-4"></div>
            </div>
        </div>
    </div>
</section>

<script>
    function submitQuiz() {
        const questions = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Questions));
        let score = 0;

        questions.forEach(q => {
            const selected = document.querySelector(`input[name="question_${q.QuestionId}"]:checked`);
            if (selected && parseInt(selected.value) === q.CorrectOptionId) {
                score++;
            }
        });

        const total = questions.length;
        const percent = (score / total) * 100;
        document.getElementById("result").innerHTML = `
            <div class="alert alert-info">
                <strong>Result:</strong> You scored ${score} out of ${total} (${percent.toFixed(1)}%)
            </div>
        `;
    }
</script>
